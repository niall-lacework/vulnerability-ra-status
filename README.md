# vulnerability-ra-status
A tool to monitor the status of vulnerability RA services

---

## Setup

### Pre-requisites

-   Git
-   Github Access Token with Repo Read Access, see [here](https://docs.github.com/en/authentication/keeping-your-account-and-data-secure/creating-a-personal-access-token).
-   Python 3.10

### Install & Setup Virtual Environment

First setup a python virtual environment. This is important to do as it will stop your  development environment
packages from clashing with you local Python.

```bash
# Install venv if not already created
python3 -m pip install venv

# Create a virtual environment
python3 -m venv venv

# Activate you virtual environment
source venv/bin/activate

# Note to deactivate later use:
deactivate
```

Now when you use Python it will be pointing to the one in your virtual environment

### Install Dev Requirements

Python 3.10 is required.

```bash
python -m pip install -r requirements-dev.txt
```

### Install  Project Dependencies

```bash
python -m pip install . --force-reinstall
```

## Code Health & Sanitization

To ensure the project remains readable and maintainable there are a number of "safety checks" in place that will
prevent you from merging you code into the main codebase if they catch a problem.

### Linter Check

Enforces PEP8 Style guidelines through Flake8. This ensures code remains readable and in compliance with Python
coding styles.

To run a linter check on your code with Flake8 run the following from the base directory:

```bash
flake8 --docstring-convention numpy vulnerability_ra_status
```

### Type Hinting

As Python is a dynamically-typed language it is easy to introduce bugs into a project around the expected input and
output types. Due to Python being dynamically-typed these 'bugs' would only be found at runtime, and only if we hit that
line of code, which can be problematic. In order to reduce this problem and minimize those types of bugs  enforces
"Type Hinting" through MyPy. MyPy will scan the project and identify any discrepancies in the typing.

To run MyPy and validate type hinting on your code run the following from the base directory:

```bash
mypy vulnerability_ra_status
```

### Testing & Code Coverage

To ensure the tool is as usable as possible we write and execute unit tests across all packages of the project.
Tests are written using PyTest. Any new code added **must** have some unit tests validating its functionality. This is
enforced through code coverage tools to ensure a certain level of coverage is maintained.

To run tests, run the following:

```bash
pytest
```

To run code coverage with your test execution:

```bash
coverage run -m pytest
# Produce a html report for easy viewing and reading in your browser
coverage html
```

## How to Use
```bash
vuln-status --help
usage: vuln-status [-h] --service SERVICE --commit COMMIT [--git-access-token GIT_ACCESS_TOKEN]

Vulnerability RA Status

options:
  -h, --help            show this help message and exit
  --service SERVICE     Service to check. Must be one of:[athena-vuln-eval, athena-redis-cacheloader, athena-redis, vuln-cr-poller, vuln-gcr-poller, vuln-evaluator, vuln-scan-runner, vuln-scanner, vuln-cve-fixes-aggr]
  --commit COMMIT       commit id
  --github-access-token GITHUB_ACCESS_TOKEN
                        Github access token
```

## Checking the status of a commit
### Setting the Github Access Token
1. As an environment variable.
```bash
export GITHUB_ACCESS_TOKEN=<your_github_access_token>
```
2. As a command line argument.
```bash
vuln-status --service athena-vuln-eval --commit 8057d85 --git-access-token <GITHUB_ACCESS_TOKEN>
```

This will check the status of the commit. The status will be printed to the console and will be one of:
- **PRODUCTION**: The commit is in production.
- **PRE-PRODUCTION**: The commit is in pre-production.
- **SHADOW**: The commit is in shadow.
- **POST_MERGE**: The commit is in post-merge.
- **ON_MERGE**: The commit is in on-merge.
- **UNKNOWN**: The commit is not in any of the above states.
 

---

## Codefresh Build Status

| Service  | pre-merge | on-merge | post-merge | shadow | pre-prod | production |
| ------------- | ------------- | ------------- | ------------- | ------------- | ------------- | ------------- |
| **Vulnerability**  |  |  | [![Codefresh build status]( https://g.codefresh.io/api/badges/pipeline/lacework/Vulnerability%2Fpost-merge-pipeline?type=cf-1&key=eyJhbGciOiJIUzI1NiJ9.NWVmNTAxOGU4Y2FjOGQzYTkxYjg3ZDEx.RJ3DEzWmBXrJX7m38iExJ_ntGv4_Ip8VTa-an8gBwBo)]( https://g.codefresh.io/pipelines/edit/new/builds?id=624aaff745f33388306c7161&pipeline=post-merge-pipeline&projects=Vulnerability&projectId=623e0ef3a4104bb262381704) | [![Codefresh build status]( https://g.codefresh.io/api/badges/pipeline/lacework/Vulnerability%2Fshadow_pipeline?type=cf-1&key=eyJhbGciOiJIUzI1NiJ9.NWVmNTAxOGU4Y2FjOGQzYTkxYjg3ZDEx.RJ3DEzWmBXrJX7m38iExJ_ntGv4_Ip8VTa-an8gBwBo)]( https://g.codefresh.io/pipelines/edit/new/builds?id=623e0f748302f4a9402a6d6f&pipeline=shadow_pipeline&projects=Vulnerability&projectId=623e0ef3a4104bb262381704) | [![Codefresh build status]( https://g.codefresh.io/api/badges/pipeline/lacework/Vulnerability%2Fpreprod_pipeline?type=cf-1&key=eyJhbGciOiJIUzI1NiJ9.NWVmNTAxOGU4Y2FjOGQzYTkxYjg3ZDEx.RJ3DEzWmBXrJX7m38iExJ_ntGv4_Ip8VTa-an8gBwBo)]( https://g.codefresh.io/pipelines/edit/new/builds?id=623ff669a4104b76cd3818c5&pipeline=preprod_pipeline&projects=Vulnerability&projectId=623e0ef3a4104bb262381704) | [![Codefresh build status]( https://g.codefresh.io/api/badges/pipeline/lacework/Vulnerability%2Fproduction_pipeline?type=cf-1&key=eyJhbGciOiJIUzI1NiJ9.NWVmNTAxOGU4Y2FjOGQzYTkxYjg3ZDEx.RJ3DEzWmBXrJX7m38iExJ_ntGv4_Ip8VTa-an8gBwBo)]( https://g.codefresh.io/pipelines/edit/new/builds?id=6240d5b828a3e55efc2ddef9&pipeline=production_pipeline&projects=Vulnerability&projectId=623e0ef3a4104bb262381704) |
| vuln-eval  | [![Codefresh build status]( https://g.codefresh.io/api/badges/pipeline/lacework/Vulnerability%2Fvuln-eval-pre-merge?type=cf-1&key=eyJhbGciOiJIUzI1NiJ9.NWVmNTAxOGU4Y2FjOGQzYTkxYjg3ZDEx.RJ3DEzWmBXrJX7m38iExJ_ntGv4_Ip8VTa-an8gBwBo)]( https://g.codefresh.io/pipelines/edit/new/builds?id=624ab15445f33382b16c7167&pipeline=vuln-eval-pre-merge&projects=Vulnerability&projectId=623e0ef3a4104bb262381704) | [![Codefresh build status]( https://g.codefresh.io/api/badges/pipeline/lacework/Vulnerability%2Fvuln-eval-on-merge?type=cf-1&key=eyJhbGciOiJIUzI1NiJ9.NWVmNTAxOGU4Y2FjOGQzYTkxYjg3ZDEx.RJ3DEzWmBXrJX7m38iExJ_ntGv4_Ip8VTa-an8gBwBo)]( https://g.codefresh.io/pipelines/edit/new/builds?id=624ab123c7517392e360a773&pipeline=vuln-eval-on-merge&projects=Vulnerability&projectId=623e0ef3a4104bb262381704) |  |  |  |  |
| athena-redis-db  | [![Codefresh build status]( https://g.codefresh.io/api/badges/pipeline/lacework/Vulnerability%2Fathena-redis-db-pre-merge?type=cf-1&key=eyJhbGciOiJIUzI1NiJ9.NWVmNTAxOGU4Y2FjOGQzYTkxYjg3ZDEx.RJ3DEzWmBXrJX7m38iExJ_ntGv4_Ip8VTa-an8gBwBo)]( https://g.codefresh.io/pipelines/edit/new/builds?id=624ab0ecc75173a6ef60a771&pipeline=athena-redis-db-pre-merge&projects=Vulnerability&projectId=623e0ef3a4104bb262381704) | [![Codefresh build status]( https://g.codefresh.io/api/badges/pipeline/lacework/Vulnerability%2Fathena-redis-db-on-merge?type=cf-1&key=eyJhbGciOiJIUzI1NiJ9.NWVmNTAxOGU4Y2FjOGQzYTkxYjg3ZDEx.RJ3DEzWmBXrJX7m38iExJ_ntGv4_Ip8VTa-an8gBwBo)]( https://g.codefresh.io/pipelines/edit/new/builds?id=624ab094c75173e57760a76f&pipeline=athena-redis-db-on-merge&projects=Vulnerability&projectId=623e0ef3a4104bb262381704) |  |  |  |  |
| vuln-scanner  | [![Codefresh build status]( https://g.codefresh.io/api/badges/pipeline/lacework/Vulnerability%2Fvuln-scanner-pre-merge%20(Platform)?type=cf-1&key=eyJhbGciOiJIUzI1NiJ9.NWVmNTAxOGU4Y2FjOGQzYTkxYjg3ZDEx.RJ3DEzWmBXrJX7m38iExJ_ntGv4_Ip8VTa-an8gBwBo)]( https://g.codefresh.io/pipelines/edit/new/builds?id=6267d25f19fe92726cf8671b&pipeline=vuln-scanner-pre-merge%20(Platform)&projects=Vulnerability&projectId=623e0ef3a4104bb262381704) | [![Codefresh build status]( https://g.codefresh.io/api/badges/pipeline/lacework/Vulnerability%2Fvuln-scanner-on-merge%20(Platform)?type=cf-1&key=eyJhbGciOiJIUzI1NiJ9.NWVmNTAxOGU4Y2FjOGQzYTkxYjg3ZDEx.RJ3DEzWmBXrJX7m38iExJ_ntGv4_Ip8VTa-an8gBwBo)]( https://g.codefresh.io/pipelines/edit/new/builds?id=6267d27819fe925c22f8671c&pipeline=vuln-scanner-on-merge%20(Platform)&projects=Vulnerability&projectId=623e0ef3a4104bb262381704) |  |  |  |  |
| vuln-cve-fixes-aggr  | [![Codefresh build status]( https://g.codefresh.io/api/badges/pipeline/lacework/Vulnerability%2Fvuln_cve_fixes_aggr_pre_merge_pipeline?type=cf-1&key=eyJhbGciOiJIUzI1NiJ9.NWVmNTAxOGU4Y2FjOGQzYTkxYjg3ZDEx.RJ3DEzWmBXrJX7m38iExJ_ntGv4_Ip8VTa-an8gBwBo)]( https://g.codefresh.io/pipelines/edit/new/builds?id=62ab39d5660cbda10b378d26&pipeline=vuln_cve_fixes_aggr_pre_merge_pipeline&projects=Vulnerability&projectId=623e0ef3a4104bb262381704) | [![Codefresh build status]( https://g.codefresh.io/api/badges/pipeline/lacework/Vulnerability%2Fvuln_cve_fixes_aggr_on_merge_pipeline?type=cf-1&key=eyJhbGciOiJIUzI1NiJ9.NWVmNTAxOGU4Y2FjOGQzYTkxYjg3ZDEx.RJ3DEzWmBXrJX7m38iExJ_ntGv4_Ip8VTa-an8gBwBo)]( https://g.codefresh.io/pipelines/edit/new/builds?id=62ab39eb64889808cfe18eba&pipeline=vuln_cve_fixes_aggr_on_merge_pipeline&projects=Vulnerability&projectId=623e0ef3a4104bb262381704) |  |  |  |  |
| vuln-cr-poller  | [![Codefresh build status]( https://g.codefresh.io/api/badges/pipeline/lacework/Vulnerability%2Fvuln_cr_poller_pre_merge_pipeline?type=cf-1&key=eyJhbGciOiJIUzI1NiJ9.NWVmNTAxOGU4Y2FjOGQzYTkxYjg3ZDEx.RJ3DEzWmBXrJX7m38iExJ_ntGv4_Ip8VTa-an8gBwBo)]( https://g.codefresh.io/pipelines/edit/new/builds?id=6283832519fe92c95bf891e3&pipeline=vuln_cr_poller_pre_merge_pipeline&projects=Vulnerability&projectId=623e0ef3a4104bb262381704) | [![Codefresh build status]( https://g.codefresh.io/api/badges/pipeline/lacework/Vulnerability%2Fvuln_cr_poller_on_merge_pipeline?type=cf-1&key=eyJhbGciOiJIUzI1NiJ9.NWVmNTAxOGU4Y2FjOGQzYTkxYjg3ZDEx.RJ3DEzWmBXrJX7m38iExJ_ntGv4_Ip8VTa-an8gBwBo)]( https://g.codefresh.io/pipelines/edit/new/builds?id=6283832019fe924b3ff891df&pipeline=vuln_cr_poller_on_merge_pipeline&projects=Vulnerability&projectId=623e0ef3a4104bb262381704) |  |  |  |  |
| vuln-evaluator  | [![Codefresh build status]( https://g.codefresh.io/api/badges/pipeline/lacework/Vulnerability%2Fvuln_evaluator_pre_merge_pipeline?type=cf-1&key=eyJhbGciOiJIUzI1NiJ9.NWVmNTAxOGU4Y2FjOGQzYTkxYjg3ZDEx.RJ3DEzWmBXrJX7m38iExJ_ntGv4_Ip8VTa-an8gBwBo)]( https://g.codefresh.io/pipelines/edit/new/builds?id=62b2ed47660cbd2eb63798dc&pipeline=vuln_evaluator_pre_merge_pipeline&projects=Vulnerability&projectId=623e0ef3a4104bb262381704) | [![Codefresh build status]( https://g.codefresh.io/api/badges/pipeline/lacework/Vulnerability%2Fvuln_evaluator_on_merge_pipeline?type=cf-1&key=eyJhbGciOiJIUzI1NiJ9.NWVmNTAxOGU4Y2FjOGQzYTkxYjg3ZDEx.RJ3DEzWmBXrJX7m38iExJ_ntGv4_Ip8VTa-an8gBwBo)]( https://g.codefresh.io/pipelines/edit/new/builds?id=62b2ed43660cbdad853798d8&pipeline=vuln_evaluator_on_merge_pipeline&projects=Vulnerability&projectId=623e0ef3a4104bb262381704) |  |  |  |  |

---

## Production Labels

| Project             | prodn1 | prodn2 | prodn3 | euprodn1 | auprodn1 |
| ------------------- | ------ | ------ | ------ | -------- | -------- |
| athena-redis-db     |        |        |        |          |          |
| vuln-scanner        |        |        |        |          |          |
| vuln-cve-fixes-aggr |        |        |        |          |          |
| vuln-cr-poller      |        |        |        |          |          |
| vuln-gcr-poller     |        |        |        |          |          |
| vuln-evaluator      |        |        |        |          |          |
